"use strict";(self["webpackChunkstu_admin"]=self["webpackChunkstu_admin"]||[]).push([[0],{2e3:function(t,e,a){a.r(e),a.d(e,{default:function(){return q}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"studentInfo",attrs:{id:"studentInfo"}},[e("div",{staticClass:"tableHeader",attrs:{id:"tableHeader"}},[e("el-row",{staticStyle:{height:"100%","margin-left":"10px"},attrs:{type:"flex",justify:"start",align:"middle",gutter:5}},[e("el-col",{attrs:{span:3}},[e("el-input",{attrs:{placeholder:"请输入学生姓名"},model:{value:t.nameInput,callback:function(e){t.nameInput=e},expression:"nameInput"}})],1),e("el-col",{attrs:{span:3}},[e("el-input",{attrs:{placeholder:"请输入专业"},model:{value:t.majorInput,callback:function(e){t.majorInput=e},expression:"majorInput"}})],1),e("el-col",{staticStyle:{"margin-left":"15px"},attrs:{span:3,pull:1}},[e("el-button",{attrs:{type:"primary",size:"medium",loading:t.searchLoading},on:{click:t.searchClick}},[t._v("查询")])],1),e("el-col",{staticStyle:{"margin-left":"15px"},attrs:{span:3,push:11}},[e("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.addStuClick}},[t._v("添加学生")])],1)],1)],1),e("div",{staticClass:"table"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%"},attrs:{stripe:"","highlight-current-row":"","show-header":t.showHeader,data:t.tableData,height:t.tableHeight}},[e("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(t){return[e("student-info-expand",{attrs:{"stu-name":t.row.name,"stu-id":t.row.studentid}})]}}])}),e("el-table-column",{attrs:{prop:"studentid",label:"学号"}}),e("el-table-column",{attrs:{prop:"name",label:"姓名"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{attrs:{size:"medium"}},[t._v(t._s(a.row.name))])]}}])}),e("el-table-column",{attrs:{prop:"age",label:"年龄"}}),e("el-table-column",{attrs:{prop:"sex",label:"性别"}}),e("el-table-column",{attrs:{prop:"major",label:"专业"}}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.handleEdit(a.$index,a.row)}}},[t._v("编辑 ")]),e("el-button",{attrs:{size:"mini",type:"danger",loading:a.row.loading},on:{click:function(e){return t.handleDelete(a.$index,a.row)}}},[t._v("删除 ")])]}}])})],1)],1),e("el-dialog",{ref:"dialog",attrs:{title:"编辑学生信息",visible:t.dialogVisible,width:"30%","before-close":t.beforeDialClose,"destroy-on-close":""},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("student-info-edit",{ref:"stuEdit",attrs:{type:"update"}})],1),e("el-dialog",{ref:"addDialog",attrs:{title:"添加学生信息",visible:t.addDialogVisible,width:"30%","destroy-on-close":""},on:{"update:visible":function(e){t.addDialogVisible=e}}},[e("student-info-edit",{ref:"stuAdd",attrs:{type:"add"},on:{stuInfoEditCallBack:t.addCallBack}})],1)],1)},l=[],i=a(2996),n=a.n(i),o=a(5574),r=a.n(o),d=(a(7658),a(58));function u(){return(0,d.W)({url:"/stu-admin/student/selectAll",method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}})}function c(t){return(0,d.W)({url:"/stu-admin/student/selectByName",method:"get",params:{name:t},headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}})}function h(t){return(0,d.W)({url:"/stu-admin/student/selectByMajor",method:"get",params:{major:t},headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}})}function m(t){return(0,d.W)({url:"/stu-admin/student/deleteById",method:"get",params:{student_id:t},headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}})}function f(t){return(0,d.W)({url:"/stu-admin/student/update",method:"post",data:t,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}})}function p(t){return(0,d.W)({url:"/stu-admin/student/add",method:"post",data:t,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}})}function g(t,e){return(0,d.W)({url:"/stu-admin/student/addCurriculum",method:"post",data:{student_id:t,majors:e},headers:{"Content-Type":"application/json"}})}function b(t,e){return(0,d.W)({url:"/stu-admin/student/deleteCurriculum",method:"post",data:{student_id:t,majors:e},headers:{"Content-Type":"application/json"}})}function w(t){return(0,d.W)({url:"/stu-admin/student/selectStudentAllCurriculum",method:"get",params:{studentid:t},headers:{"Content-Type":"application/x-www-form-urlencoded"}})}var D=function(){var t=this,e=t._self._c;return e("div",{staticClass:"expandInfo"},[e("div",{staticClass:"mainModule"},[e("el-row",{staticStyle:{width:"100%"},attrs:{type:"flex"}},[e("el-col",{staticClass:"table",attrs:{span:12}},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],staticClass:"table",attrs:{"highlight-current-row":"","max-height":300,"show-header":!1,data:t.tableData}},[e("el-table-column",{attrs:{prop:"id",label:"课程id"}}),e("el-table-column",{attrs:{prop:"name",label:"课程名字"}}),e("el-table-column",{attrs:{prop:"credit",label:"学分"}}),e("el-table-column",{attrs:{prop:"time",label:"时长"}})],1)],1),e("el-col",{attrs:{span:12}},[e("div",{staticClass:"description"},[e("el-descriptions",{attrs:{title:"课程统计"}},[e("el-descriptions-item",{attrs:{label:"修读课程数"}},[t._v(t._s(t.courseTotal))]),e("el-descriptions-item",{attrs:{label:"修读总学分"}},[t._v(t._s(t.courseScores))])],1),e("div",{staticClass:"courseModify"},[e("el-button",{attrs:{type:"primary"},on:{click:t.modifyCourseClick}},[t._v("修改课程信息")])],1)],1)])],1)],1),e("el-dialog",{attrs:{title:"编辑学生课程信息",visible:t.dialogVisible,width:"70%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("student-course-modify",{attrs:{"stu-name":t.stuName,"stu-id":t.stuId,selectCourse:t.tableData}})],1)],1)},y=[],C=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stuCourseModify"},[e("div",{staticClass:"courseTransfer"},[e("el-transfer",{attrs:{filterable:"",data:t.transferData,titles:["所有课程","已选课程"]},model:{value:t.selectValue,callback:function(e){t.selectValue=e},expression:"selectValue"}})],1),e("el-button",{staticClass:"modifyButton",attrs:{type:"primary",loading:t.modifyLoading},on:{click:t.modifyClick}},[t._v("修改")])],1)},v=[],x=a(8865),k={name:"studentCourseModify",props:{stuName:String,stuId:Number,selectCourse:Array},data(){return{allCourse:[],modifyLoading:!1,transferData:[],selectValue:[]}},methods:{complement(t,e){return[...t.filter((t=>!e.includes(t))),...e.filter((e=>!t.includes(e)))]},modifyClick(){let t=[];for(let l of this.selectCourse)t.push(l.id);let e=this.complement(t,this.selectValue),a=[],s=[];for(let l of e)this.selectValue.includes(l)?a.push(l):s.push(l);0!==a.length&&g(this.stuId,a).then((t=>{!0===t.success?n().success(`增加: ${a} 成功`):n().warning(`增加: ${a} 失败，错误信息: ${t.message}`)})),0!==s.length&&b(this.stuId,s).then((t=>{!0===t.success?n().success(`删除: ${s} 成功`):n().success(`删除: ${s} 失败，错误信息: ${t.message}`)}))}},beforeMount(){(0,x.kk)().then((t=>{if(!0===t.status){this.allCourse=t.data,console.log(this.allCourse);let e={};for(let t of this.selectCourse)e[t.id]=t;console.log(e);let a=[];for(let t of this.allCourse){const s=t.id;void 0!==e[s]&&this.selectValue.push(s),a.push({key:s,label:t.name,disabled:!1})}this.transferData=a,console.log(a)}else n().warning(`查询信息错误: ${t.message}`)}))}},I=k,S=a(1001),_=(0,S.Z)(I,C,v,!1,null,"1d16c63a",null),T=_.exports,$={name:"StudentInfoExpand",components:{studentCourseModify:T},data(){return{dialogVisible:!1,tableLoading:!1,courseTotal:0,courseScores:0,tableData:[]}},props:{stuName:String,stuId:Number},created(){console.log("expand name: "+this.stuName+" id: "+this.stuId),this.tableLoading=!0,w(this.stuId).then((t=>{if(!0===t.status){this.tableData=t.data,this.courseTotal=this.tableData.length;let e=0;for(let t of this.tableData)e+=t.credit;this.courseScores=e}else n().warning(t.message),this.courseTotal=0,this.courseScores=0})).then((()=>{this.tableLoading=!1}))},methods:{modifyCourseClick(){this.dialogVisible=!0}}},j=$,L=(0,S.Z)(j,D,y,!1,null,"7d07579a",null),E=L.exports,V=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stuInfoModify"},[e("div",{staticClass:"stuEditForm"},[e("el-form",{attrs:{model:t.formData,"label-position":"right","label-width":"80px"}},[e("el-form-item",{attrs:{label:"学生姓名"}},[e("el-input",{staticClass:"formInput",model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),e("el-form-item",{attrs:{label:"年龄"}},[e("el-input",{model:{value:t.formData.age,callback:function(e){t.$set(t.formData,"age",e)},expression:"formData.age"}})],1),e("el-form-item",{attrs:{label:"性别"}},[e("el-select",{staticClass:"formInput",attrs:{placeholder:"请选择性别"},model:{value:t.formData.sex,callback:function(e){t.$set(t.formData,"sex",e)},expression:"formData.sex"}},[e("el-option",{attrs:{value:"男"}}),e("el-option",{attrs:{value:"女"}})],1)],1),e("el-form-item",{attrs:{label:"专业班级"}},[e("el-select",{staticClass:"formInput",attrs:{placeholder:"请选择活动专业"},model:{value:t.formData.major,callback:function(e){t.$set(t.formData,"major",e)},expression:"formData.major"}},t._l(this.majorData,(function(t){return e("el-option",{key:t.value,attrs:{value:t.value}})})),1)],1)],1),e("el-button",{staticStyle:{width:"150px"},attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("提交")])],1)])},H=[];function W(){return(0,d.W)({url:"/stu-admin/clazz/selectAll",method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}})}var B={name:"StudentInfoEdit",props:{type:String},data(){return{hasSubmit:!1,majorData:[],formData:{studentid:"",name:"",age:"",sex:"",major:""}}},created(){W().then((t=>{if(!0===t.status){const e=t.data;let a=[];for(let t=0;t<e.length;t++)a.push({label:e[t].classname,value:e[t].classname});this.majorData=a}else n().warning("获取班级列表失败: "+t.message)}))},methods:{onSubmit(){console.log(this.type),"add"===this.type?p(this.formData).then((t=>{!0===t.success?(n().success("提交成功"),this.hasSubmit=!0,this.$emit("stuInfoAddCallBack",this.formData)):n().warning(t.message)})):f(this.formData).then((t=>{!0===t.success?(n().success("提交成功"),this.hasSubmit=!0,this.$emit("stuInfoEditCallBack",this.formData)):n().warning(t.message)}))}}},N=B,A=(0,S.Z)(N,V,H,!1,null,"f0cd7806",null),M=A.exports,z={name:"StudentInfo",components:{StudentInfoExpand:E,StudentInfoEdit:M},extends:r(),data(){return{addDialogVisible:!1,dialogVisible:!1,tableLoading:!1,showHeader:!1,searchLoading:!1,originSelectData:{},selectIndex:-1,nameInput:"",majorInput:"",tableHeight:0,tableData:[]}},mounted(){this.$refs.dialog.rendered=!0},created(){console.log("table length: "+this.tableData.length),this.showHeader=0!==this.tableData.length,this.$nextTick((()=>{this.tableHeight=document.getElementById("studentInfo").offsetHeight-document.getElementById("tableHeader").offsetHeight})),this.tableLoading=!0,u().then((t=>{!0===t.status&&(this.tableData=t.data,this.addLoadingToResp()),this.showHeader=0!==this.tableData.length,this.tableLoading=!1}))},methods:{beforeDialClose(t){const e=this.$refs.stuEdit.hasSubmit;e||(this.$refs.stuEdit.formData.studentid=this.originSelectData.studentid,this.$refs.stuEdit.formData.name=this.originSelectData.name,this.$refs.stuEdit.formData.age=this.originSelectData.age,this.$refs.stuEdit.formData.major=this.originSelectData.major,this.$refs.stuEdit.formData.sex=this.originSelectData.sex),t()},addCallBack(t){this.tableData.push(t)},addLoadingToResp(){for(let t=0;t<this.tableData.length;t++)this.$set(this.tableData[t],"loading",!1)},handleEdit(t,e){this.selectIndex=t,Object.assign(this.originSelectData,e),this.$refs.stuEdit.formData=e,this.dialogVisible=!0},handleDelete(t,e){e.loading=!0,m(e.studentid).then((a=>{!0!==a.success?n().warning(a.message):n().success("删除成功"),e.loading=!1,this.tableData.splice(t,1)}))},addStuClick(){this.addDialogVisible=!0},searchClick(){this.searchLoading=!0,""!==this.nameInput?c(this.nameInput).then((t=>{!0===t.status&&(this.tableData=t.data,this.addLoadingToResp()),this.showHeader=0!==this.tableData.length,this.searchLoading=!1})):""!==this.majorInput?h(this.majorInput).then((t=>{!0===t.status&&(this.tableData=t.data,this.addLoadingToResp()),this.showHeader=0!==this.tableData.length,this.searchLoading=!1})):u().then((t=>{!0===t.status&&(this.tableData=t.data,this.addLoadingToResp()),this.showHeader=0!==this.tableData.length,this.tableLoading=!1,this.searchLoading=!1}))}}},R=z,Z=(0,S.Z)(R,s,l,!1,null,"459aeb4a",null),q=Z.exports},8865:function(t,e,a){a.d(e,{A:function(){return o},Hf:function(){return n},bq:function(){return i},kk:function(){return l}});var s=a(58);function l(){return(0,s.W)({url:"/stu-admin/curriculum/selectAll",method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}})}function i(t){return(0,s.W)({url:"/stu-admin/curriculum/add",method:"post",data:t,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}})}function n(t){return(0,s.W)({url:"/stu-admin/curriculum/update",method:"post",data:t,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}})}function o(t){return(0,s.W)({url:"/stu-admin/curriculum/deleteById",method:"get",params:{id:t},headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}})}}}]);
//# sourceMappingURL=0.b156c8c3.js.map